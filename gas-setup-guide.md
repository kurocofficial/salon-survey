# Google Apps Script セットアップガイド

## 1. スプレッドシートの準備

### スプレッドシート作成
1. [Google Sheets](https://sheets.google.com/) にアクセス
2. 「空白」をクリックして新しいスプレッドシートを作成
3. スプレッドシートの名前を「ヘアサロン運営データ」に変更
4. URLから**スプレッドシートID**をコピーして保存
   - URL例: `https://docs.google.com/spreadsheets/d/ABC123DEF456GHI789/edit`
   - スプレッドシートID: `ABC123DEF456GHI789`

## 2. Google Apps Script設定

### プロジェクト作成
1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「ヘアサロンアンケート連携」に変更

### コード設定
1. `Code.gs` ファイルの内容を全て削除
2. `google-apps-script.js` ファイルの内容をコピー&ペースト
3. **重要**: 14行目の `YOUR_SPREADSHEET_ID` を実際のスプレッドシートIDに置き換え

```javascript
// 例：
const spreadsheetId = 'ABC123DEF456GHI789';
```

### 権限設定
1. 「保存」ボタンをクリック
2. 「実行」ボタンをクリックして初回認証
3. 「権限の確認」→「詳細」→「ヘアサロンアンケート連携（安全ではないページ）に移動」
4. 「許可」をクリック

## 3. Webアプリとして公開

### デプロイ設定
1. 「デプロイ」→「新しいデプロイ」をクリック
2. 種類の選択で「ウェブアプリ」を選択
3. 設定：
   - **説明**: 「ヘアサロンアンケート連携 v1.0」
   - **実行者**: 「自分」
   - **アクセスできるユーザー**: 「全員」
4. 「デプロイ」をクリック
5. **WebアプリのURL**をコピーして保存
   - 例: `https://script.google.com/macros/s/ABC123.../exec`

## 4. フロントエンド側の設定

### script.jsの更新
1. `script.js` ファイルを開く
2. 77行目の `YOUR_SCRIPT_ID` を実際のWebアプリURLに置き換え

```javascript
// 例：
const response = await fetch('https://script.google.com/macros/s/ABC123.../exec', {
```

## 5. テスト方法

### 1. GASの動作テスト
1. Google Apps Scriptで「実行」ボタンをクリック
2. エラーが出ないことを確認

### 2. Webアプリのテスト
1. WebアプリのURLにブラウザでアクセス
2. 「Hello from Google Apps Script!」と表示されることを確認

### 3. フォーム送信テスト
1. GitHub Pagesで公開されたアンケートページにアクセス
2. テストデータを入力して送信
3. スプレッドシートにデータが反映されることを確認

## 6. トラブルシューティング

### よくある問題と解決法

#### ❌ CORSエラーが発生する
**原因**: GASの公開設定が正しくない
**解決法**: 
- アクセスできるユーザーを「全員」に設定
- 新しいデプロイを作成

#### ❌ データが送信されない
**原因**: WebアプリURLが正しく設定されていない
**解決法**:
- `script.js` のURLを確認
- GASのWebアプリURLをコピー&ペースト

#### ❌ スプレッドシートにデータが表示されない
**原因**: スプレッドシートIDが間違っている
**解決法**:
- URLからスプレッドシートIDを正しくコピー
- GASコードの14行目を確認

#### ❌ 権限エラーが発生する
**原因**: スプレッドシートへのアクセス権限がない
**解決法**:
- GASで初回実行時に権限を許可
- スプレッドシートの共有設定を確認

## 7. セキュリティ設定（推奨）

### スプレッドシートの保護
1. スプレッドシートで「データ」→「シートとレンジを保護」
2. 「シート」を選択して「権限を設定」
3. 「自分のみ」に設定して「完了」

### 定期的なメンテナンス
- 月1回程度、不要なデータの削除
- GASのログ確認
- スプレッドシートのバックアップ作成

## 完了チェックリスト

- [ ] スプレッドシートを作成した
- [ ] スプレッドシートIDをコピーした
- [ ] GASプロジェクトを作成した
- [ ] `google-apps-script.js` の内容をペーストした
- [ ] スプレッドシートIDを置き換えた
- [ ] 初回実行で権限を許可した
- [ ] Webアプリとして公開した
- [ ] WebアプリURLをコピーした
- [ ] `script.js` のURLを更新した
- [ ] テスト送信を実行した
- [ ] スプレッドシートにデータが反映された

すべてチェックできれば設定完了です！